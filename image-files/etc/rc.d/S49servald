#!/bin/sh /etc/rc.common
# Copyright (C) 2006 OpenWrt.org

START=49

start() {
  # Clear out old inittab incase it tries to include ttyATH0
  # atleast that way a reboot will get things working.
  if [ -e /overlay/etc/inittab ]; then
    rm /overlay/etc/inittab
    reboot
  fi

  # Start servald
  e2fsck -a
  dosfsck /dev/sda1
  mount -a
  export SERVALINSTANCE_PATH=/etc/serval
  mkdir -p $SERVALINSTANCE_PATH

  # But don't start servald until we have flashed the radio
  if [ ! -e /etc/rc.d/S48flashradio ]; then
    /etc/serval/runservald &
  fi
}

stop() {
  export SERVALINSTANCE_PATH=/etc/serval
  /serval/servald stop
}
